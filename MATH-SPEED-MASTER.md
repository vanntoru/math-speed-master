# 10 の補数 Reflex Trainer 仕様書

*Version 2.6 — 最終統合版*

---

## 0. 概要

小学校 2 年生向けに「10 の補数」と「10−□」の瞬時暗算を鍛えるローカル GUI アプリ。1 セッション 20 問で平均リアクションタイム (RT) と遅延問題を可視化し、ハイブリッド戦略 (ブリッジング 10 & 補数加算法) の基礎を構築する。

| 項目       | 内容                                                                            |
| -------- | ----------------------------------------------------------------------------- |
| 対応 OS    | Windows 10 / 11 (64 bit)                                                      |
| 言語 / GUI | **Python 3.10+** & **Tkinter**                                                |
| 実行形式     | `python` 直実行 or **PyInstaller exe** (―onefile ―noconsole)                     |
| 依存ライブラリ  | `pyttsx3 >= 2.9` (TTS)                                                        |
| 画面構成     | 左 = カード (600×540, #222)<br>右 = 履歴 & KPI & 操作                                  |
| フォント     | 問題: **Yu Gothic 110 pt**<br>メッセージ: Yu Gothic 60 pt<br>遅延ダイアログ: Consolas 48 pt |
| 音声       | Windows SAPI 日本語 (Haruka/Ayumi) / `rate=220`                                  |
| 操作キー     | **Enter** = スタート & 回答確定<br>**Esc / Reset ボタン** = リセット                         |

---

## 1. 機能一覧

### 1.1 出題モード

| モード            | 表示例    | 期待反応  | 読み上げ           |
| -------------- | ------ | ----- | -------------- |
| **A** 補数カード    | `3`    | 7 を即答 | 「3 の 10 の補数は?」 |
| **B** 10−□ カード | `10−3` | 7 を即答 | 「10 ひく 3 は?」   |

*サイドパネルのラジオボタンで随時切替。セッション中は変更禁止。*

### 1.2 出題ロジック

* 1〜9 を **各 2 回以上** 含む 20 問キューを生成。
* 連続同一数字を回避する軽度シャッフル。
* キュー枯渇時は自動再生成。

### 1.3 セッションフロー

1. アプリ起動 → 「Enter で開始」表示。
2. **Enter** → セッション開始 & 第 1 問提示。
3. 各問で Enter 押下 ➜ RT 計測 (秒・小数 2 桁) → 次問。
4. 20 問終了で:

   * カード中央に **平均 RT** を 2 行表示。
   * 右 KPI バー: 平均 ≦ 0.80 s なら緑。
   * **0.80 s 超の問題一覧**を特大フォント・カスタムダイアログで表示。
5. **Esc** or Reset ボタン → 初期状態へ。

### 1.4 KPI & ダッシュボード

* 履歴テーブル: 直近 20 件の個別 RT。
* 平均 RT ラベル (リアルタイム更新)。
* KPI 色分け: 平均 ≤ 0.80 s ➜ 緑 / それ以外 ➜ 灰。

### 1.5 UI／アクセシビリティ

* 背景 #222222／文字 #FFFFFF でコントラスト確保。
* 110 pt 表示で 4 m 教室掲示でも識字可。
* 指１本操作 (Enter) に統一し、視線移動を最小化。

### 1.6 TTS

* `pyttsx3` を非同期スレッドで実行し GUI 非ブロッキング。
* Rate = 220。ユーザー設定で変動可 (`_TTS_RATE`).

---

## 2. 開発／ビルド手順

```bash
# 1. 依存インストール
py -m pip install --upgrade pip
py -m pip install pyttsx3

# 2. 開発用ホットラン
python phase0_reflex_trainer.py  # v2.6 コード

# 3. EXE 化 (配布用)
py -m PyInstaller --onefile --noconsole phase0_reflex_trainer.py
# dist/phase0_reflex_trainer.exe が生成
```

*アイコン追加:* `--icon app.ico`

---

## 3. カスタマイズポイント

| 項目     | 設定箇所                                 | 備考            |
| ------ | ------------------------------------ | ------------- |
| 遅延判定閾値 | `_THRESH = 0.80`                     | 0.6 s などに変更可能 |
| KPI 閾値 | `_KPI = 0.80`                        | 平均タイム基準変更     |
| フォント   | `_FONT_PROB / _FONT_MSG / _FONT_DLG` | 他言語環境に合わせ変更   |
| TTS 速度 | `_TTS_RATE`                          | 150–250 推奨    |
| 出題数    | `_NUM_Q = 20`                        | 10～100 で自由設定  |

---

## 4. 今後の拡張 (Phase 1–4 準備枠)

* **ブリッジング 10 高速化**: 2 桁−1 桁 くり下がり対応ドリルを `Bridge10Drill` として追加可能。
* **適応スイッチ訓練**: 問題毎に最適戦略を自己申告させる UI (キー S/B 等)。
* **CSV ログ保存**: `records` を日付別に書き出し、進捗グラフ化。

---

## 5. ライセンス & 配布

* ソースコード: MIT License (予定)。
* 音声合成: Windows SAPI 日本語音声利用許諾に準拠。

---

## 6. 変更履歴

| Ver | 日付    | 主要追加・修正                                 |
| --- | ----- | --------------------------------------- |
| 1.0 | 初期    | Phase 0 補数カード GUI (Space/Enter)         |
| 1.3 | 07‑07 | 20 問 & 平均 RT、自動終了、同一問題排除                |
| 2.0 | 07‑07 | **モード B** (10−□) 追加、2 モード統合 GUI         |
| 2.1 | 07‑07 | 各 1–9 を 2 回以上出題保証ロジック                   |
| 2.2 | 07‑07 | Tkinter bind 名衝突バグ修正 (`setup_bindings`) |
| 2.3 | 07‑07 | 0.8 s 超問題を一覧表示                          |
| 2.4 | 07‑07 | フォント 110 pt / 60 pt 拡大、UI 調整            |
| 2.5 | 07‑07 | メッセージはみ出し解消 (カード幅 640)                  |
| 2.6 | 07‑07 | **特大フォントダイアログ (48 pt)** で遅延問題表示         |

---

**End of Spec**
